<!DOCTYPE html>
<html
  lang="en"
  xmlns="http://www.w3.org/1999/xhtml"
  xmlns:th="http://www.thymeleaf.org"
>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Bookings</title>
    <link rel="stylesheet" type="text/css" th:href="@{/styles/templateStyles.css}" />
  </head>
  <body onload="setCalendarDates()">

    <div class="page-container">
        <header th:replace="mainTemplate :: header"></header>
        <div class="content-wrapper">
            <h1>Make a booking</h1>
            <div class="calendar">
                <h1>Calendar & Location</h1>
                <form action="/searchDate" name="dateForm" method="get">
                    <label for="date"
                    >Please select the day you would like to book your desk</label
                    ><br />
                    <!--          Date range is from today to 1 week from today -->
                    <input id="date" name="date" type="date"/><br>
                    <label for="location">
                        Please select office location <br>
                        <select name="location" id="location">
                            <option value="Bristol">Bristol</option>
                            <option value="Cardiff">Cardiff</option>
                        </select>
                        <br>
                    </label>
                    <input type="submit" class="submit-button">
                </form>
            </div>

<!--            Dynamic content - rendering available desks-->
            <section class="desks" th:if="${deskList != null}">

                <h1 th:text="'Map of desks for the ' + ${map.getLocation} + ' office'"></h1>
                <div class="map-section">
                    <div class="img-wrapper">
                        <img th:src="${map.getImage()}" alt="">
                    </div>
                </div>
                <h1>Available Desks</h1>
                <div class="desk-item" th:each="desk:${deskList}">

                    <div>
                        Desk Number
                        <div th:text="${desk.getDesk_number()}"></div>
                    </div>
                    <div>
                        Monitors
                        <div th:text="${desk.isHas_monitors()} ? 'Yes' : 'No'"></div>
                    </div>
                    <div>
                        Desk Type
                        <div th:text="${desk.getDesk_type()}"></div>
                    </div>
                    <div>
                        Location
                        <div th:text="${desk.getDesk_location()}"></div>
                    </div>
                    <form th:action="">
                        <button class="booking-button" type="submit">Book</button>
                    </form>

                </div>
            </section>
        </div>

        <footer th:replace="mainTemplate :: footer"></footer>

    </div>

    <script>

      function setCalendarDates(){
        //create dates in String format
        let today = new Date();
        let oneWeeksTime = new Date();
        oneWeeksTime.setDate(oneWeeksTime.getDate() + 7);
        today = getFormattedDate(today);
        //set default value to today
          document.getElementById("date").value = today;
        oneWeeksTime = getFormattedDate(oneWeeksTime);
        let dateField = document.getElementById("date");

        dateField.setAttribute("max", oneWeeksTime);
        dateField.setAttribute("min", today);
      }
      function getFormattedDate(date){
        let day = date.getDate();
        let month = date.getMonth() + 1;
        let year = date.getFullYear();
        if(day < 10){day = '0' + day;}
        if(month < 10){month = '0' + month;}
        return year + '-' + month + '-' + day;
      }


    </script>
  </body>
</html>
